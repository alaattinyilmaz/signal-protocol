Here is my private Identity Key
75151745874135875874574268787
I've already registered my IK and SPK to server. So I'm skipping IK and SPK registration part
In signature generation I fixed the random variable to 1748178 so that you can re-generate if you want
My ID number is 26045

Trying to delete OTKs... Because I forgot them
Sending message is:  {'ID': 26045, 'H': 54770639310972145221644845241635889327836204847740506165049070102509042617608, 'S': 32063410385739714088848293613961078261068373853112301199126449214958267493722}
All OTKs deleted !

New Feature: Checking the status of the inbox and keys! Just send your signature of ID number and your ID via Status method
Sending message is:  {'ID': 26045, 'H': 54770639310972145221644845241635889327836204847740506165049070102509042617608, 'S': 32063410385739714088848293613961078261068373853112301199126449214958267493722}
{'numMSG': 0, 'numOTK': 0, 'StatusMSG': 'You have 0 unread messages in your mailbox.\n You have 0 OTKs left.'}
You have 0 unread messages in your mailbox.
 You have 0 OTKs left.


Creating OTKs starting from index 0...
{0: [87155327834106145919002728062697390764742160390235174329608570915554681096016, 43659647229286057250383773020054452178996780373459817019458347904623499497841, 1666258657131505995901765731412811870804638155720804877631328005947762118550], 1: [7684531807658476898530495929797214085372345305597466650809804538267169588772, 17099447950662756480144299238863048398599709130749399412949679764617098512080, 92418434015460656602989559400880620578642877829273036887805016837745742401443], 2: [31728943931842520243952849047431757218385311207331663605671530664858187858701, 50089108408004600369053684074902669573129776409751772980066342460900630555141, 26622251658414388254325897830281356084248194102510386377793529447346907266125], 3: [31552192483608930872007618136773267110937130719495348831459671698399902625089, 31392056127928999226732620370580218201236748914526594632092899947828439812802, 111802121955540732134466240933701591276056025366675300021636133642054940134388], 4: [36060511290611652892944571421731003910398771645778660638242849280115414239702, 21094742933315530117219544483986357021520586767586370238681875632004876429702, 99646559201620088486061580189829828167881132456451094804927068427439707081879], 5: [19846878318097274638737106702599307301796573179767622372109041778201809045102, 43721521917039028360482320420434912993885024349936901963665520169869727868646, 1259506085695848803608100341303407869086951812766576420975054939964493860536], 6: [76187344786398493863961795192065776645661197900083093120719771391049373570812, 78693251496502240221275359455607402680089884511490231539819209273684792431269, 112151565679422462662689016398010947737458472533964779247916111251142860669604], 7: [32333892726638126728143281499811960118819006653532483802072172776265194732200, 86852588770266753205363207637067432908015659827741780108703660976759980084220, 64199369637217251487578037257805279745332970022663763652358378098074699882521], 8: [114795359256357478651110535792286257795226167442384777050305254143184180946975, 79926321862734450575025270222535140521313914223836107706187700631999007116102, 56965711205272059499540965571168759731131428677143333864964727399773442627114], 9: [2658741163442591075955248855873492508222646239130499340276620794735510880341, 43099621481181617732933710536745522001509290370423987485254825800201511629225, 51053042107740944443000395785102644263534867268909580286291826084261667972299]}


I'll request messages from the pseudo client. It will send me 5 messages. But this time no invalid hmac
Signing my stuID with my private IK
Sending message is:  {'ID': 26045, 'H': 54770639310972145221644845241635889327836204847740506165049070102509042617608, 'S': 32063410385739714088848293613961078261068373853112301199126449214958267493722}
Your favourite pseudo-client sent you 5 messages. You can get them from the server

Checking the status of the inbox and keys...
{'numMSG': 5, 'numOTK': 10, 'StatusMSG': 'You have 5 unread messages in your mailbox.\n You have 10 OTKs left.'}
You have 5 unread messages in your mailbox.
 You have 10 OTKs left.


I'll get those messages one by one and decrypt them as I did in phase 2. I'll keep the decrypted messages to use later in grading part. 
Sending message is:  {'ID': 26045, 'H': 54770639310972145221644845241635889327836204847740506165049070102509042617608, 'S': 32063410385739714088848293613961078261068373853112301199126449214958267493722}
{'IDB': 18007, 'OTKID': 0, 'MSGID': 1, 'MSG': 53142599270224736398785830452786881725204655453762750493730495724541070063438575181415129360282366738559333523802658769661410698386762522801522401822663482697794243749307185119919121697200370290455892, 'EK.X': 39187529511911476564526223359822357776860386974464695751033199991423528041445, 'EK.Y': 46475269768656190413807332619318941526857425312947575378216411407506467307523}
I got this from client 18007: 
 53142599270224736398785830452786881725204655453762750493730495724541070063438575181415129360282366738559333523802658769661410698386762522801522401822663482697794243749307185119919121697200370290455892
Saving the collected plaintext somewhere 
https://www.youtube.com/watch?v=s3Nr-FoA9Ps 
https://www.youtube.com/watch?v=379oevm2fho 
https://www.youtube.com/watch?v=bc0KhhjJP98 
https://www.youtube.com/watch?v=2aHkqB2-46k 
https://www.youtube.com/watch?v=1hLIXrlpRe8


Now I want to send messages to my friend. Her id is 11111. Yes she is also imaginary
Signing The stuIDB of party B with my private IK
Requesting party B's OTK ...
{'KEYID': 0, 'OTK.X': 103100247337620787678146720265367593816154401691448578396072639319041063607878, 'OTK.Y': 4750254611903237606261091315664914453515077573273973033355893425165437066958}
The other party's OTK public key is acquired from the server ...

Generating Ephemeral key
This is my message: Hello darkness my old friend
Generating the KDF chain for the encryption and the MAC value generation

Generating session key using my EK and my friends Public OTK/ Phase 3...
T is: 
 (0xce5f66f2433d7d91dfd8977fcc38bbbc26f35584b01ad6d5187a7ff372c2c644 , 0xda92144c1c524c7dc9f746b269c8d99fcae69656869ea96d0d0bd229b7d14466)
U is: 
 b'\xce_f\xf2C=}\x91\xdf\xd8\x97\x7f\xcc8\xbb\xbc&\xf3U\x84\xb0\x1a\xd6\xd5\x18z\x7f\xf3r\xc2\xc6D\xda\x92\x14L\x1cRL}\xc9\xf7F\xb2i\xc8\xd9\x9f\xca\xe6\x96V\x86\x9e\xa9m\r\x0b\xd2)\xb7\xd1DfMadMadWorld'
Ks is: 
 b'uB\x12\x9f\xeaq\xc6\xa3 \x1cH\x06@\x0c\xa8\xf4Kj8\xbas\xd7\xb6 \xf8M\x91X\xbc_\x9e\xe4'
Kenc1 is: 
 b'\xa6\xe8\xc9J\xd27\xb5D\x7f\x17\x9d\x97\x0f2(F\xde\xbc{F]\x87\xb3{\x8a#:\x80\x16k\xfa\x82'
Khmac1 is: 
 b"G\xc1>S'\x8a\xe5\xc1\x82\x1c\xbb\x1e&\r\xf7\xb1\xc0\xeb\xce\x86\xfb\x00\xd9L2'\x13\x109h\xbf\xe5"
Kkdf1 is: 
 b'h\xba\xf5v\x9b6\x85\xde\xcc\x12\r\x1b\x83OP67\x89c\xb9R\xb8\xaa\\\x8fV/v\x8a$\xabr'

Encrypting the message with Kenc1 and created a mac value with Khmac1. Then created msg in this format: nonce+cipher+hmac. Converted to int to be able to send it

Sending the message to the server, so it would deliver it to my friend whenever she is active ...
Sending message is:  {'IDA': 26045, 'IDB': 11111, 'OTKID': 0, 'MSGID': 1, 'MSG': 739016399583033250499914861055470278098654683497841208247127725661325187275996917786488390083407150546670365743269717742244912592480574381272219456115022114263778, 'EK.X': 114159897507501307209959833117065657383630763606705801372930309308499951830815, 'EK.Y': 54590603183220802885047867536334318578189161506625703073569515774134968622980}

Your message sent succesfully


I'll send one more message in the same block: I've come to talk with you again

This time I should use second generation keys. Generating them  using kkkdf1

Kkdf1 is: 
 b'h\xba\xf5v\x9b6\x85\xde\xcc\x12\r\x1b\x83OP67\x89c\xb9R\xb8\xaa\\\x8fV/v\x8a$\xabr'
Kenc2 is: 
 b'\xd2\x876\xbcA\xd5\xb4\x18\xd7\x89f\xbcp\\\x80\xcd\x00\xf0\t\x9d\x8e\xce\xb8\xf8[g\xa8\xa8\x8b\xdfmf'
Khmac2 is: 
 b'\x98\xd8\xee\xd1e\xfb:\xd5\x1b\xe9Dk*\x18\xb5\x9dj\xe9\x94?\xe9\t0ZX3\xf8\x99\x99w\xdf\xb5'
Kkdf2 is: 
 b'\x8e8\xf4\xb9Hs\xa9\x8c\xd6\xb8\x0c\x7f\x14K\x9dhw\x80$\xa3[%\x06\'"\xe5i\x90%$\x8a\x93'

Encrypt and create hmac etc.. Similar to above. use Kenc2 and Khmac2
Sending the message to the server, so it would deliver it to pseudo-client/user whenever it is active ...
Sending message is:  {'IDA': 26045, 'IDB': 11111, 'OTKID': 0, 'MSGID': 2, 'MSG': 76795513682380873638501535995799344324156965989498239314355563993429769665280455054801253611043521490109303535789764413788386231408249460404657036009573029816562053322021765, 'EK.X': 114159897507501307209959833117065657383630763606705801372930309308499951830815, 'EK.Y': 54590603183220802885047867536334318578189161506625703073569515774134968622980}
Your message sent succesfully


Now I'll encrypt the messages I retrived initially from the server and send it to pseudo-client(18007) for auto-grading
I'll send them in a SINGLE BLOCK. But ORDER of the messages should be considered

Signing The stuIDB of party B with my private IK
Requesting party B's OTK ...
{'KEYID': 0, 'OTK.X': 103100247337620787678146720265367593816154401691448578396072639319041063607878, 'OTK.Y': 4750254611903237606261091315664914453515077573273973033355893425165437066958}
The other party's OTK public key is acquired from the server ...
Get the message from the list ...
Generating ephemeral key
Private part of my EK:  33161652030964568447746428528154376605557272128395859381968190211413467283205



Get a message from the inbox ...
Generating the KDF chain for the encryption and the MAC value generation
Generating session key using my EK and my friend's Public OTK/ Phase 3...
T is: 
 (0x64fbdd83a19b099dec29062670b8c934a3bd9c3779fba91fd886cbfd0e198c81 , 0x323616498c237f8f540a0ceb2c02ead11ef566714f993cd6171196c2ff91c14d)
U is: 
 b'd\xfb\xdd\x83\xa1\x9b\t\x9d\xec)\x06&p\xb8\xc94\xa3\xbd\x9c7y\xfb\xa9\x1f\xd8\x86\xcb\xfd\x0e\x19\x8c\x8126\x16I\x8c#\x7f\x8fT\n\x0c\xeb,\x02\xea\xd1\x1e\xf5fqO\x99<\xd6\x17\x11\x96\xc2\xff\x91\xc1MMadMadWorld'
Ks is: 
 b'\xf9Y\x89\x00e\x04}\xbc}\x02\x04Bh~L\x04\xc7P\xa9|\x1c\x10\xfa\xd6\xa5\xbdri\x95\xdap\xef'
Kenc1 is: 
 b'\x05\xa6\xf2\x04q\xd7Smm\xeb\xcb\x0e\x10\n\xb1$\x86\xfc\xa4\xe9\x10^V\x9e\xf8\xab5\x90G\x0f\xbbN'
Khmac1 is: 
 b'8^5\xdc\x84\xd2\xa3\x9d\x9d\x9d\x125\x0e=\xf5\xc5\x1d\x87\x9eqNa"1\xc8\x05\xcdg\x8b\xf7\xb0\xae'
Kkdf1 is: 
 b'\xe9yC\x8d\xdbli\x00\x1f\x94wF\x9e\xcd\x96j\xfeD\xd2\x1f\xfc\xafO\x1d\xfd\xd9\x8a\xcd C#n'

Sending the message to the server, so it would deliver it to pseudo-client/user whenever it is active ...
Sending message is:  {'IDA': 26045, 'IDB': 18007, 'OTKID': 0, 'MSGID': 1, 'MSG': 18245332563397437823416576632308312149316317085195673136953867851546958375795431879184746185298024241328984356795755466799227706076476343068071090190387189017242034472173577790184469613468499673943748, 'EK.X': 3194039507433718231119046307072555652607995945951956371809702938369068915275, 'EK.Y': 105543123962822635925264864676458647326660328804335279213192999904942424134904}
Your message sent succesfully


Get a message from the inbox ...
Generating the KDF chain for the encryption and the MAC value generation
Generating session key using my EK and my friend's Public OTK/ Phase 3...
T is: 
 (0x64fbdd83a19b099dec29062670b8c934a3bd9c3779fba91fd886cbfd0e198c81 , 0x323616498c237f8f540a0ceb2c02ead11ef566714f993cd6171196c2ff91c14d)
U is: 
 b'd\xfb\xdd\x83\xa1\x9b\t\x9d\xec)\x06&p\xb8\xc94\xa3\xbd\x9c7y\xfb\xa9\x1f\xd8\x86\xcb\xfd\x0e\x19\x8c\x8126\x16I\x8c#\x7f\x8fT\n\x0c\xeb,\x02\xea\xd1\x1e\xf5fqO\x99<\xd6\x17\x11\x96\xc2\xff\x91\xc1MMadMadWorld'
Ks is: 
 b'\xf9Y\x89\x00e\x04}\xbc}\x02\x04Bh~L\x04\xc7P\xa9|\x1c\x10\xfa\xd6\xa5\xbdri\x95\xdap\xef'
Kenc1 is: 
 b'\x05\xa6\xf2\x04q\xd7Smm\xeb\xcb\x0e\x10\n\xb1$\x86\xfc\xa4\xe9\x10^V\x9e\xf8\xab5\x90G\x0f\xbbN'
Khmac1 is: 
 b'8^5\xdc\x84\xd2\xa3\x9d\x9d\x9d\x125\x0e=\xf5\xc5\x1d\x87\x9eqNa"1\xc8\x05\xcdg\x8b\xf7\xb0\xae'
Kkdf1 is: 
 b'\xe9yC\x8d\xdbli\x00\x1f\x94wF\x9e\xcd\x96j\xfeD\xd2\x1f\xfc\xafO\x1d\xfd\xd9\x8a\xcd C#n'
Kenc2 is: 
 b'\xb3k5\xec\x06[Q\xf4\x93\x82\xef\xad4\x94\x18\x1a\xabuk\xeb\t\xbc\x99\x81\x8b\xcb\xe8\x1c\xe2]\x08\xe4'
Khmac2 is: 
 b'\x8af\xca\xb0?\xf9\xd5\xcf:\xf4o\x05\xbb\x88bd\xcf^\xf7\xb3~\xa7\xa0\x17\x16\x01\x13\xfc\xbd\x95\xbf\x8b'
Kkdf2 is: 
 b'\xbb\xfe\x89\xdb\xcd\xa6_\xad\xff\x0f\x10$h}\t\x003\xbf6\xe8K\x16\xf0\xc0\x94\xe8\x81\xfa\x99\x01<\xc6'

Sending the message to the server, so it would deliver it to pseudo-client/user whenever it is active ...
Sending message is:  {'IDA': 26045, 'IDB': 18007, 'OTKID': 0, 'MSGID': 2, 'MSG': 17928991692486867364982971938786466988972795811142587699218783195274886113485665815336273908988137714688831688331673645310393531255767888525926933030958864494092589945795079143405804483110769607607031, 'EK.X': 3194039507433718231119046307072555652607995945951956371809702938369068915275, 'EK.Y': 105543123962822635925264864676458647326660328804335279213192999904942424134904}
Your message sent succesfully


.
.
.
.


Checking the status of the inbox ...
Sending message is:  {'ID': 26045, 'H': 54770639310972145221644845241635889327836204847740506165049070102509042617608, 'S': 32063410385739714088848293613961078261068373853112301199126449214958267493722}
{'numMSG': 0, 'numOTK': 9, 'StatusMSG': 'You have 0 unread messages in your mailbox.\n You have 9 OTKs left. The largest key id is 9'}
You have 0 unread messages in your mailbox.
 You have 9 OTKs left. The largest key id is 9


